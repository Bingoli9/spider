## 分布式爬虫

### 基本架构

分布式爬虫采用主从模式。主从模式是由一台主机作为控制节点，负责管理所有运行网络爬虫的主机，爬虫只需要从控制节点那里接收任务，并把新生成的任务提交给控制节点。而控制节点则需要与所有爬虫进行通信，因此控制节点是瓶颈，容易导致整个分布式网络爬虫系统性能下降。

<center>
    <img src="2"/>
</center>



### 控制节点

控制调度器通过三个进程来协调URL管理器和数据存储器的工作：

1. URL管理进程，负责URL的管理和将URL传递给爬虫节点；
2. 数据提取进程，负责读取爬虫节点返回的数据；
3. 数据存储进程，负责将数据提取进程中提交数据进行本地存储。

【URL管理器】

如果采用set内存去重方式，直接存储大量URL链接，尤其是URL连接很长的时候，很容易造成内存溢出，所以需要将爬取过URL进行MD5处理。我们同时添加save_progress和 load_process方法进行序列化的操作，将未爬取URL集合和已经爬取的URL集合序列化到本地，保存当前进度。

【数据存储器】

将序列化集合存储到数据库。

【控制调度器 】

控制调度器主要是产生并启动URL管理进程、数据提取进程和数据存储进程，同时维护4个队列保持进程间通信，分别url_queue、result_queue、conn_q、stroe_q。

- url_queue是URL管理进程将URL传递给爬虫节点的通道。
- result_queue队列是爬虫节点将数据返回给数据提取进程的通道
- conn_q队列是数据提取进程将新的URL数据提交给URL管理进程的通道
- store_q队列是数据提取进程将获取到的数据交给数据存储进程的通道。

### 爬虫节点

- 爬虫调度器从控制节点中的url_q队列读取URL
- 爬虫调度器调用HTML下载器、HTML解析器获取网页中新的URL和标题摘要
- 爬虫调度器将新的URL和标题摘要result_q队列交给控制节点

